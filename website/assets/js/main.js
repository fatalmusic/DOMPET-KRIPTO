function getLocalStorageSize(){return new Promise((b,c)=>{if(localStorage){if(empty(localStorage.getItem("storageSize"))){let a=0;try{for(a=250;a<=1e4;a+=250)localStorage.setItem("testSize",new Array(1024*a+1).join("a"))}catch(f){localStorage.removeItem("testSize"),localStorage.setItem("storageSize",a-250);let d=a-250-getLocalStorageUsedSize();b({size:a-250,remaining:d})}}else{let e=localStorage.getItem("storageSize")-getLocalStorageUsedSize();b({size:parseInt(localStorage.getItem("storageSize")),remaining:e})}}else c({size:0,remaining:0})})}function getLocalStorageUsedSize(){return JSON.stringify(localStorage).length/1e3}function sum(a,b){return a+b}function formatHour(a){let b=("00"+a.getHours()).slice(-2),c=("00"+a.getMinutes()).slice(-2);return b+":"+c}function formatDate(a){let b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return d+" / "+c+" / "+b}function formatDateHuman(a){let b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return b+" / "+c+" / "+d}function formatDateHyphenated(a){let b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear();return b+"-"+c+"-"+d}function previousYear(a){let b=a.getDate(),c=a.getMonth()+1,d=a.getFullYear()-1;return new Date(Date.parse(d+"-"+c+"-"+b))}function previousMonth(a){return new Date(a.getTime()-2592e6)}function previousWeek(a){return new Date(a.getTime()-5184e5)}function empty(a){return"object"==typeof a&&null!==a&&0===Object.keys(a).length||null==a||""===a.toString().trim()}function validJSON(b){try{let a=JSON.parse(b);if(a&&"object"==typeof a)return!0}catch(c){}return!1}function separateThousands(b){let a=b.toString().split(".");return a[0]=a[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a.join(".")}function abbreviateNumber(c,d){let b=[{value:1,symbol:""},{value:1e3,symbol:"k"},{value:1e6,symbol:"M"},{value:1e9,symbol:"B"},{value:1e12,symbol:"T"},{value:1e15,symbol:"P"},{value:1e18,symbol:"E"},],a;for(a=b.length-1;a>0&&!(c>=b[a].value);a--);return(c/b[a].value).toFixed(d).replace(/\.0+$|(\.[0-9]*[1-9])0+$/,"$1")+b[a].symbol}function positiveToNegative(a){return-Math.abs(a)}function capitalizeFirstLetter(a){return a.charAt(0).toUpperCase()+a.slice(1)}function insertAfter(b,a){a.parentNode.insertBefore(b,a.nextSibling)}function detectMobile(){var a;let b=!1;return a=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(b=!0),b}document.addEventListener("DOMContentLoaded",async()=>{let Z,$="../api/",_=new XNotify("BottomRight"),aa=setInterval(bd,3e4),ab=setInterval(be,3e4),ac=setInterval(bf,3e4),ad=setInterval(bg,3e4),ae=localStorage.getItem("token"),af=localStorage.getItem("username"),ag={usd:"$",gbp:"\xa3",idr:"Rp ",eur:"\u20AC"},ah={currency:"idr"},ai={},a=document.body,aj=document.getElementById("global-market-cap"),ak=document.getElementById("global-volume"),al=document.getElementById("login-wrapper"),am=document.getElementById("login-username"),an=document.getElementById("login-password"),o=document.getElementById("login-button"),p=document.getElementById("login-noapi-button"),q=document.getElementById("noapi-logout-button"),r=document.getElementById("logout-button"),s=document.getElementById("loading-overlay"),t=document.getElementById("popup-overlay"),b=document.getElementById("popup-wrapper"),ao=b.getElementsByClassName("bottom")[0],ap=b.getElementsByClassName("title")[0],u=b.getElementsByClassName("close-button")[0],aq=document.getElementById("page-dashboard"),v=document.getElementById("page-market"),ar=document.getElementById("page-holdings"),as=document.getElementById("page-activity"),g=document.getElementById("page-settings"),h=document.getElementsByClassName("headers-wrapper"),at=document.getElementById("dashboard-market-list"),au=document.getElementById("dashboard-holdings-list"),av=document.getElementById("dashboard-market-cap"),aw=document.getElementById("dashboard-market-change"),ax=document.getElementById("dashboard-holdings-value"),ay=document.getElementById("page-number"),az=v.getElementsByClassName("header market-cap")[0],w=document.getElementById("previous-page"),x=document.getElementById("next-page"),i=g.getElementsByClassName("choice"),j=g.getElementsByClassName("server-choice"),aA=document.getElementById("navbar-background"),y=document.getElementById("navbar-dashboard"),z=document.getElementById("navbar-market"),A=document.getElementById("navbar-holdings"),B=document.getElementById("navbar-activity"),C=document.getElementById("navbar-settings"),aB=document.getElementById("page-navigation"),aC=document.getElementById("market-list"),aD=document.getElementById("holdings-list"),aE=document.getElementById("activity-list"),D=document.getElementById("holdings-value-card"),E=document.getElementById("holdings-add-card"),aF=document.getElementById("holdings-more-menu"),F=document.getElementById("activity-add-card"),k=document.getElementById("activity-search-input"),G=document.getElementById("activity-search-button"),H=document.getElementById("more-edit"),I=document.getElementById("more-remove"),aG=document.getElementById("holdings-total-value"),J=document.getElementById("theme-toggle"),aH=document.getElementById("theme-css-input"),K=document.getElementById("theme-css-reset"),L=document.getElementById("theme-css-confirm"),aI=document.getElementById("input-current-password"),aJ=document.getElementById("input-new-password"),aK=document.getElementById("input-repeat-password"),aL=document.getElementById("input-access-pin"),aM=document.getElementById("sharing-url"),aN=document.getElementById("input-eth-address"),aO=document.getElementById("storage-progress"),aP=document.getElementById("storage-text"),M=document.getElementById("noapi-clear-button"),N=document.getElementById("change-password-button"),O=document.getElementById("manage-accounts-button"),P=document.getElementById("change-pin-button"),Q=document.getElementById("copy-url-button"),R=document.getElementById("import-tokens-button"),S=document.getElementById("import-holdings-button"),T=document.getElementById("export-holdings-button"),U=document.getElementById("import-activity-button"),V=document.getElementById("export-activity-button"),W=document.getElementById("delete-cache-button");detectMobile()?a.id="mobile":a.id="desktop",a3();let X=new URL(window.location.href);"view"===X.searchParams.get("access")?(s.classList.add("active"),a.classList.add("view-mode"),document.head.innerHTML+='<link rel="stylesheet" href="./assets/css/view.css">',setTimeout(()=>{s.classList.contains("active")&&s.classList.remove("active"),a2("holdings");let a=X.searchParams.get("pin");empty(a)?empty(ae)&&_.error({title:"Error",description:"Access PIN not found in the URL."}):(ae=a,bf())},500)):(empty(localStorage.getItem("defaultPage"))?a2("market"):a2(localStorage.getItem("defaultPage")),bl().then(()=>{bd(),be(),bf(),bg()}).catch(a=>{console.log(a)})),window.addEventListener("resize",()=>{ba(),a7(),clearTimeout(window.resizedFinished),window.resizedFinished=setTimeout(()=>{y.classList.contains("active")&&bd(),z.classList.contains("active")&&be(),A.classList.contains("active")&&bf()},1e3),a3()}),document.addEventListener("click",a=>{if(A.classList.contains("active")&&!aF.classList.contains("hidden")){let b=["more-menu","more-menu","more","more-icon","more-path",];b.includes(a.target.classList[0])||b.includes(a.target.parentElement.classList[0])||aF.classList.add("hidden")}}),document.addEventListener("keydown",a=>{"enter"===a.key.toLocaleLowerCase()&&(al.classList.contains("active")&&o.click(),b.classList.contains("active")&&document.getElementById("popup-confirm")&&document.getElementById("popup-confirm").click())}),o.addEventListener("click",()=>{aV(am.value,an.value)}),p.addEventListener("click",()=>{let a=localStorage.getItem("NoAPI"),b;b=empty(a)?{}:validJSON(a)?JSON.parse(a):{},Z=new NoAPI(b,"website",localStorage);let c=document.createElement("style");c.innerHTML=".noapi-hidden { display:none !important; }",document.getElementsByTagName("head")[0].appendChild(c),empty(localStorage.getItem("defaultPage"))?a2("market"):a2(localStorage.getItem("defaultPage")),bl().then(()=>{bd(),be(),bf(),bg()}).catch(a=>{console.log(a)})}),q.addEventListener("click",()=>{window.location.reload(!0)}),M.addEventListener("click",()=>{aZ("Deleting No-API Data",'<button class="reject" id="popup-cancel">Batal</button><button class="resolve warning" id="popup-confirm">Hapus</button>',"240px","120px"),document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{localStorage.removeItem("NoAPI"),window.location.reload(!0)})}),r.addEventListener("click",()=>{aW()}),P.addEventListener("click",()=>{bo("pin",aL.value).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):_.success({title:"PIN Changed",description:a.message})}).catch(a=>{console.log(a),_.error({title:"Error",description:"Couldn't change access PIN."})})}),t.addEventListener("click",()=>{a$()}),u.addEventListener("click",()=>{a$()}),H.addEventListener("click",()=>{let d=aF.getAttribute("data-coin"),a=aF.getAttribute("data-symbol"),b=aF.getAttribute("data-amount"),c='<input id="popup-coin" placeholder="ID koin... (Contoh.. BTC)" value="'+a+'" readonly><input id="popup-amount" placeholder="Jumlah... (Contoh.. 2.5)" value="'+b+'" type="number"><button class="reject" id="popup-cancel">Batal</button><button class="resolve" id="popup-confirm">Konfirmasi</button>';aZ("Editing Asset",c,"300px","240px"),document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{bs(d,document.getElementById("popup-amount").value).then(a=>{a8(),"message"in a?(a$(),_.success({title:"Portofolio diperbarui",description:a.message})):_.error({title:"Error",description:a.error}),bf()}).catch(a=>{_.error({title:"Error",description:"Portofolio gagal diperbarui."})})}),aF.classList.add("hidden")}),I.addEventListener("click",()=>{let a=aF.getAttribute("data-coin");aF.classList.add("hidden"),aZ("Deleting Asset",'<button class="reject" id="popup-cancel">Batal</button><button class="resolve warning" id="popup-confirm">Hapus</button>',"240px","120px"),document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{bt(a).then(a=>{a8(),a$(),"message"in a?_.success({title:"Portofolio dihapus",description:a.message}):_.error({title:"Error",description:a.error}),bf()}).catch(a=>{_.error({title:"Error",description:"Portofolio gagal dihapus."})})})}),y.addEventListener("click",()=>{a2("dashboard")}),z.addEventListener("click",()=>{a2("market")}),A.addEventListener("click",()=>{a2("holdings")}),B.addEventListener("click",()=>{a2("activity")}),C.addEventListener("click",()=>{a2("settings")}),w.addEventListener("click",()=>{a4()}),x.addEventListener("click",()=>{a5()});for(let c=0;c<h.length;c++){let l=h[c],Y=l.getAttribute("data-list");if(["dashboardMarket","dashboardHoldings"].includes(Y)){let m=l.getElementsByClassName("header");for(let d=0;d<m.length;d++){let n=m[d],aQ=n.getAttribute("data-item");n.addEventListener("click",()=>{let a="ascending";"ascending"===localStorage.getItem(Y+"SortOrder")&&(a="descending"),bc(Y,aQ,a)})}}}D.addEventListener("click",()=>{"override"===ah.transactionsAffectHoldings&&0===aD.getElementsByClassName("more").length&&bS().then(a=>{a=bT(a);let b=[],e={},c=0,f=previousYear(new Date).getTime()/1e3;for(let d=0;d<366;d++){let g=(f+c)*1e3;e[formatDate(new Date(g)).replaceAll(" ","")]={holdingsValue:0},c+=86400}Object.keys(a).map(i=>{let d=a[i],c=d.id,g=parseFloat(d.amount),h=1e3*parseInt(d.time),f=formatDate(new Date(h)).replaceAll(" ",""),j=previousYear(new Date);h>j&&"transfer"!==d.type&&(b.includes(c)||b.push(c),c in e[f]?"buy"===d.type?e[f][c]+=g:e[f][c]-=g:"buy"===d.type?e[f][c]=g:e[f][c]=-g)});let h=b.join(",");a_(2e3*b.length+6e3,"This might take a while... Don't touch anything."),j();let i=setInterval(()=>{j()},2e3);function j(){if(document.getElementById("loading-text")){let a=document.getElementById("loading-text");a.hasAttribute("data-current")?a.setAttribute("data-current",parseInt(a.getAttribute("data-current"))+1):a.setAttribute("data-current","0");let c=a.getAttribute("data-current");a.textContent="This might take a while... Don't touch anything. ("+c+" / "+b.length+")"}else clearInterval(i)}bH(h,ah.currency,previousYear(new Date),new Date).then(d=>{a0(),a_(1400,"Generating chart...");let f=Object.keys(d),h={};f.map(a=>{a in h||(h[a]={});let c=d[a].prices;for(let b=0;b<c.length;b++){let e=c[b][0],f=c[b][1],g=formatDate(new Date(e)).replaceAll(" ","");h[a][g]=f}});let b=Object.keys(e),g;for(let a=0;a<b.length;a++){let c=e[b[a-1]],i=e[b[a]];a-1>=0&&Object.keys(c).length>1&&Object.keys(c).map(d=>{"holdingsValue"!==d&&(empty(g)&&(g=a-1),c[d]<0&&(e[b[a-1]][d]=0),d in i?e[b[a]][d]=e[b[a]][d]+c[d]:e[b[a]][d]=c[d])}),Object.keys(e[b[a]]).map(c=>{if("holdingsValue"!==c){let d=e[b[a]][c]*h[c][b[a]];e[b[a]].holdingsValue+=d}})}aT(e,g)}).catch(a=>{console.log(a)})})}),E.addEventListener("click",()=>{let a=240;aZ("Tambah Portofolio",'<input id="popup-coin" placeholder="ID koin... (e.g. BTC)"><input id="popup-amount" placeholder="Jumlah... (e.g. 2.5)" type="number"><button class="reject" id="popup-cancel">Batal</button><button class="resolve" id="popup-confirm">Konfirmasi</button>',"300px",a+"px"),document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{let c=document.getElementById("popup-coin").value,d=document.getElementById("popup-amount").value;empty(c)||empty(d)?_.error({title:"Error",description:"kedua baris harus di isi."}):isNaN(d)?_.error({title:"Error",description:"hanya dapat di isi dengan angka."}):bF("symbol",c.trim().toLowerCase()).then(c=>{_.alert({title:"Mengecek...",description:"mengecek koin."});for(let e=0;e<document.getElementsByClassName("popup-list").length;e++)document.getElementsByClassName("popup-list")[e].remove();if("id"in c)bq(c.id,d);else if("matches"in c){_.info({title:"Hasil duplikat",description:"terdapat "+c.matches.length+" koin dengan simbol tersebut. silahkan pilih salah satu.",duration:8e3});let j=document.getElementById("popup-amount"),g=document.createElement("div");g.classList.add("popup-list");let f=c.matches;Object.keys(f).map(e=>{let b=f[e],c=Object.keys(b)[0],h=b[c],a=document.createElement("div");a.innerHTML='<span class="title">'+c.toUpperCase()+'</span><span class="subtitle">'+capitalizeFirstLetter(h)+"</span>",a.addEventListener("click",()=>{bq(h,d)}),g.appendChild(a)});let h=40*f;f.length>=3&&(h=120);let i=a+h+20;b.style.height=i+"px",b.style.top="calc(50% - "+i+"px / 2)",insertAfter(g,j)}else _.error({title:"Error",description:"gagal."})}).catch(a=>{console.log(a)})})}),k.addEventListener("keydown",a=>{"enter"===a.key.toLowerCase()&&G.click()}),k.addEventListener("input",()=>{if(empty(k.value)||empty(k.value.trim())){let b=aE.getElementsByClassName("event-wrapper");for(let a=0;a<b.length;a++)b[a].classList.remove("hidden")}}),G.addEventListener("click",()=>{let d=k.value;if(!empty(d)){let r=d.toLowerCase().trim(),b=aE.getElementsByClassName("event-wrapper");for(let a=0;a<b.length;a++){let f=!1,c=[],g=b[a].getAttribute("data-symbol").toLowerCase().trim(),h=b[a].getAttribute("data-date"),i=b[a].getAttribute("data-amount"),j=b[a].getAttribute("data-fee"),l=b[a].getAttribute("data-notes").toLowerCase().trim(),e=b[a].getAttribute("data-type").toLowerCase().trim();if(c.push(g),c.push(h),c.push(i),c.push(j),c.push(l),c.push(e),"transfer"===e.toLowerCase()){let m=b[a].getAttribute("data-from").toLowerCase().trim(),n=b[a].getAttribute("data-to").toLowerCase().trim();c.push(m),c.push(n)}else{let o=b[a].getAttribute("data-exchange").toLowerCase().trim(),p=b[a].getAttribute("data-pair").toLowerCase().trim(),q=b[a].getAttribute("data-price");c.push(o),c.push(p),c.push(q)}c.map(a=>{a.includes(r)&&(f=!0)}),f?b[a].classList.remove("hidden"):b[a].classList.add("hidden")}}}),F.addEventListener("click",()=>{bv("create")}),J.addEventListener("click",()=>{bo("css","").then(async a=>{"error"in a?_.error({title:"Error",description:a.error}):(J.classList.contains("active")?a1("dark"):a1("light"),await bl())}).catch(a=>{console.log(a),_.error({title:"Error",description:"Couldn't remove CSS."})})}),K.addEventListener("click",()=>{document.getElementById("custom-css")&&document.getElementById("custom-css").remove(),a1("light"),bo("css","").then(async a=>{"error"in a?_.error({title:"Error",description:a.error}):await bl()}).catch(a=>{console.log(a),_.error({title:"Error",description:"Couldn't remove CSS."})})}),L.addEventListener("click",()=>{a1("light"),bo("css",aH.value).then(async a=>{"error"in a?_.error({title:"Error",description:a.error}):await bl()}).catch(a=>{console.log(a),_.error({title:"Error",description:"Couldn't apply CSS."})})});for(let e=0;e<i.length;e++)i[e].addEventListener("click",async()=>{let a=i[e].parentElement.getAttribute("data-key"),b=i[e].getAttribute("data-value");localStorage.setItem(a,b),bk(a),await bl()});for(let f=0;f<j.length;f++)j[f].addEventListener("click",()=>{let a=j[f].parentElement.getAttribute("data-key"),b=j[f].getAttribute("data-value");bo(a,b).then(async a=>{"error"in a?_.error({title:"Error",description:a.error}):await bl()}).catch(a=>{console.log(a),_.error({title:"Error",description:"gagal."})})});function aR(){function a(a,b){bx(a,b).then(a=>{a$(),"error"in a?_.error({title:"Error",description:a.error}):_.success({title:"Tambah ke Favorit",description:a.message}),a6(),bd()}).catch(a=>{_.error({title:"Error",description:"Gagal tambahkan ke favorit."}),console.log(a)})}aZ("Tambah ke Favorit",'<input id="popup-coin" placeholder="koin ID... (e.g. BTC)"><button class="reject" id="popup-cancel">Batal</button><button class="resolve" id="popup-confirm">Konfirmasi</button>',"300px","180px"),document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{let d=document.getElementById("popup-coin"),c=d.value;empty(c)?_.error({title:"Error",description:"periksa kembali ID koin apa sudah benar."}):bF("symbol",c.trim().toLowerCase()).then(c=>{_.alert({title:"Mengecek...",description:"mengecek apakah koin terdaftar."});for(let e=0;e<document.getElementsByClassName("popup-list").length;e++)document.getElementsByClassName("popup-list")[e].remove();if("id"in c)a(c.id,c.symbol);else if("matches"in c){_.info({title:"Hasil duplikat",description:"terdapat "+c.matches.length+" koin dengan simbol tersebut. tolong pilih salah satu.",duration:8e3});let g=document.createElement("div");g.classList.add("popup-list");let f=c.matches;Object.keys(f).map(e=>{let c=f[e],d=Object.keys(c)[0],h=c[d],b=document.createElement("div");b.innerHTML='<span class="title">'+d.toUpperCase()+'</span><span class="subtitle">'+capitalizeFirstLetter(h)+"</span>",b.addEventListener("click",()=>{a(h,d)}),g.appendChild(b)});let h=40*f;f.length>=3&&(h=120);let i=180+h+20;b.style.height=i+"px",b.style.top="calc(50% - "+i+"px / 2)",insertAfter(g,d)}else _.error({title:"Error",description:"gagal menambahkan koin."})}).catch(a=>{console.log(a)})})}function aS(a,b,c){a_(1e4),bG(a).then(d=>{bH(a,ah.currency,previousYear(new Date),new Date).then(e=>{e=bK(e[a],new Date().getTime(),c),empty(d.description.fr)&&(d.description.fr="No description found for "+b.toUpperCase()+"."),aZ(b.toUpperCase()+" / "+ah.currency.toUpperCase()+" - "+d.name,'<div class="coin-popup-wrapper"><div class="coin-chart-wrapper"></div><div class="stats-wrapper noselect"><span class="stats-icon-wrapper" id="coin-popup-watchlist"><svg width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1728 647q0 22-26 48l-363 354 86 500q1 7 1 20 0 21-10.5 35.5t-30.5 14.5q-19 0-40-12l-449-236-449 236q-22 12-40 12-21 0-31.5-14.5t-10.5-35.5q0-6 2-20l86-500-364-354q-25-27-25-48 0-37 56-46l502-73 225-455q19-41 49-41t49 41l225 455 502 73q56 9 56 46z"/></svg></span><span id="coin-popup-ath">Harga tertinggi: ...</span></div></span><button class="reject" id="popup-dismiss">Kembali</button></div>',"calc(100% - 40px)","calc(100% - 40px)",{delay:1500,closeIcon:!0}),bi(document.getElementsByClassName("coin-chart-wrapper")[0],"Price",e.labels,e.tooltips,e.prices,{symbol:b});let f=parseFloat(d.market_data.ath[ah.currency]);f>1&&(f=separateThousands(f.toFixed(2))),document.getElementById("coin-popup-ath").textContent="Harga Tertinggi: "+ag[ah.currency]+f+" ("+formatDateHuman(new Date(Date.parse(d.market_data.ath_date[ah.currency]))).replaceAll(" ","")+")";let g=document.getElementById("coin-popup-watchlist");bw().then(b=>{Object.keys(b).includes(a)&&g.classList.add("active")}).catch(a=>{_.error({title:"Error",description:"Gagal."}),console.log(a)}),g.addEventListener("click",()=>{g.classList.contains("active")?by(a).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(_.success({title:"Terhapus dari Favorit",description:a.message}),g.classList.remove("active")),a6(),bd()}).catch(a=>{_.error({title:"Error",description:"Gagal."}),console.log(a)}):bx(a,b).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(_.success({title:"Tambah ke Favorit",description:a.message}),g.classList.add("active")),a6(),bd()}).catch(a=>{_.error({title:"Error",description:"Gagal."}),console.log(a)})}),document.getElementById("popup-dismiss").addEventListener("click",()=>{a$()}),setTimeout(()=>{a0()},1400)}).catch(a=>{console.log(a)})}).catch(a=>{console.log(a)})}function aT(c,s){let k=formatDate(new Date).replaceAll(" ","");if(delete c[k],!(k in c)||empty(c[k])||isNaN(c[k].holdingsValue)){let o=localStorage.getItem("holdingsData");if(validJSON(o)){c[k]={holdingsValue:0};let t=JSON.parse(o);Object.keys(t).map(a=>{c[k][a]=parseFloat(t[a].amount),c[k].holdingsValue+=parseFloat(t[a].value)})}}let p=[],q=[],a=[],r=Object.keys(c);for(let n=s;n<r.length;n++){let m=r[n];p.push(new Date(Date.parse(m))),q.push(formatDateHuman(new Date(Date.parse(m)))),c[m].holdingsValue<0?a.push(0):a.push(c[m].holdingsValue)}let b=c[k].holdingsValue,l=a.length>=1?a[a.length-1]:"-",e=a.length>=2?a[a.length-2]:"-",f=a.length>=7?a[a.length-8]:"-",g=a.length>=30?a[a.length-31]:"-",h=a.length>=90?a[a.length-91]:"-",i=a.length>=180?a[a.length-181]:"-",j=a.length>=365?a[a.length-366]:"-",d="";if(!isNaN(l)&&l>1&&(l=separateThousands(l.toFixed(2)),d+="<span>Current ("+ag[ah.currency]+"): "+l+"</span>"),!isNaN(e)&&e>1){let u=b-e==0?"":b-e>0?"positive":"negative";e=separateThousands((b-e).toFixed(2)),d+='<span class="'+u+'">1D ('+ag[ah.currency]+"): "+e+"</span>"}if(!isNaN(f)&&f>1){let v=b-f==0?"":b-f>0?"positive":"negative";f=separateThousands((b-f).toFixed(2)),d+='<span class="'+v+'">1W ('+ag[ah.currency]+"): "+f+"</span>"}if(!isNaN(g)&&g>1){let w=b-g==0?"":b-g>0?"positive":"negative";g=separateThousands((b-g).toFixed(2)),d+='<span class="'+w+'">1M ('+ag[ah.currency]+"): "+g+"</span>"}if(!isNaN(h)&&h>1){let x=b-h==0?"":b-h>0?"positive":"negative";h=separateThousands((b-h).toFixed(2)),d+='<span class="'+x+'">3M ('+ag[ah.currency]+"): "+h+"</span>"}if(!isNaN(i)&&i>1){let y=b-i==0?"":b-i>0?"positive":"negative";i=separateThousands((b-i).toFixed(2)),d+='<span class="'+y+'">6M ('+ag[ah.currency]+"): "+i+"</span>"}if(!isNaN(j)&&j>1){let z=b-j==0?"":b-j>0?"positive":"negative";j=separateThousands((b-j).toFixed(2)),d+='<span class="'+z+'">1Y ('+ag[ah.currency]+"): "+j+"</span>"}aZ("Holdings Performance",'<div class="holdings-popup-wrapper"><div class="holdings-chart-wrapper"></div><div class="stats-wrapper noselect">'+d+'</div><button class="reject" id="popup-dismiss">Kembali</button></div>',"calc(100% - 40px)","calc(100% - 40px)",{delay:1500,closeIcon:!0}),bj(document.getElementsByClassName("holdings-chart-wrapper")[0],"Value",p,q,a),document.getElementById("popup-dismiss").addEventListener("click",()=>{a$()})}async function aU(v,n,c,w){let l=formatDate(new Date).replaceAll(" ","");if(delete c[l],!(l in c)||empty(c[l])||isNaN(c[l].holdingsValue)){let r=localStorage.getItem("holdingsData");if(validJSON(r)){c[l]={holdingsValue:0};let x=JSON.parse(r);Object.keys(x).map(a=>{v===a&&(c[l][a]=parseFloat(x[a].amount),c[l].holdingsValue+=parseFloat(x[a].value))})}}let y=parseFloat(n.amount),p=parseFloat(n.price);p<=0&&(p=(await bJ(v,formatDateHyphenated(new Date(Date.parse(n.date)))))?.market_data?.current_price[ah.currency]);let s=[],t=[],b=[y*p],u=Object.keys(c);for(let q=w;q<u.length;q++){let o=u[q];s.push(new Date(Date.parse(o))),t.push(formatDateHuman(new Date(Date.parse(o)))),c[o].holdingsValue<0?b.push(0):b.push(c[o].holdingsValue)}let a=c[l].holdingsValue,m=b.length>=1?b[b.length-1]:"-",e=b.length>=2?b[b.length-2]:"-",f=b.length>=7?b[b.length-8]:"-",g=b.length>=30?b[b.length-31]:"-",h=b.length>=90?b[b.length-91]:"-",i=b.length>=180?b[b.length-181]:"-",j=b.length>=365?b[b.length-366]:"-",k=b[0],d="";if(!isNaN(m)&&m>1&&(m=separateThousands(m.toFixed(2)),d+="<span>Current ("+ag[ah.currency]+"): "+m+"</span>"),!isNaN(e)&&e>1){let z=a-e==0?"":a-e>0?"positive":"negative",A=((a-e)/a*100).toFixed(2);e=separateThousands((a-e).toFixed(2)),d+='<span class="'+z+'">1D ('+ag[ah.currency]+"): "+e+" ("+A+"%)</span>"}if(!isNaN(f)&&f>1){let B=a-f==0?"":a-f>0?"positive":"negative",C=((a-f)/a*100).toFixed(2);f=separateThousands((a-f).toFixed(2)),d+='<span class="'+B+'">1W ('+ag[ah.currency]+"): "+f+" ("+C+"%)</span>"}if(!isNaN(g)&&g>1){let D=a-g==0?"":a-g>0?"positive":"negative",E=((a-g)/a*100).toFixed(2);g=separateThousands((a-g).toFixed(2)),d+='<span class="'+D+'">1M ('+ag[ah.currency]+"): "+g+" ("+E+"%)</span>"}if(!isNaN(h)&&h>1){let F=a-h==0?"":a-h>0?"positive":"negative",G=((a-h)/a*100).toFixed(2);h=separateThousands((a-h).toFixed(2)),d+='<span class="'+F+'">3M ('+ag[ah.currency]+"): "+h+" ("+G+"%)</span>"}if(!isNaN(i)&&i>1){let H=a-i==0?"":a-i>0?"positive":"negative",I=((a-i)/a*100).toFixed(2);i=separateThousands((a-i).toFixed(2)),d+='<span class="'+H+'">6M ('+ag[ah.currency]+"): "+i+" ("+I+"%)</span>"}if(!isNaN(j)&&j>1){let J=a-j==0?"":a-j>0?"positive":"negative",K=((a-j)/a*100).toFixed(2);j=separateThousands((a-j).toFixed(2)),d+='<span class="'+J+'">1Y ('+ag[ah.currency]+"): "+j+" ("+K+"%)</span>"}if(!isNaN(k)&&k>1){let L=a-k==0?"":a-k>0?"positive":"negative",M=((a-k)/a*100).toFixed(2);k=separateThousands((a-k).toFixed(2)),d+='<span class="'+L+'">All ('+ag[ah.currency]+"): "+k+" ("+M+"%)</span>"}aZ(n.symbol.toUpperCase()+" - Holding Performance",'<div class="holdings-popup-wrapper"><div class="holdings-chart-wrapper"></div><div class="stats-wrapper noselect">'+d+'</div><button class="reject" id="popup-dismiss">Kembali</button></div>',"calc(100% - 40px)","calc(100% - 40px)",{delay:1500,closeIcon:!0}),bj(document.getElementsByClassName("holdings-chart-wrapper")[0],"Value",s,t,b),document.getElementById("popup-dismiss").addEventListener("click",()=>{a$()})}function aV(b,c){try{if(empty(Z)){console.log("Logging In...");let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{if(a.readyState===XMLHttpRequest.DONE){if(validJSON(a.responseText)){let b=JSON.parse(a.responseText);"error"in b?_.error({title:"Error",description:b.error}):b.valid&&(ae=b.token,af=b.username,localStorage.setItem("token",b.token),localStorage.setItem("username",b.username),_.success({title:"Sedang Login...",description:b.message}),setTimeout(()=>{empty(localStorage.getItem("defaultPage"))?a2("market"):a2(localStorage.getItem("defaultPage")),bl().then(()=>{bd(),be(),bf(),bg()}).catch(a=>{console.log(a)}),al.classList.remove("active")},250),an.value="",an.blur(),"admin"===af?O.classList.remove("hidden"):O.classList.add("hidden"))}else _.error({title:"Error",description:"Coba lagi."})}}),a.open("POST",$+"accounts/login.php?platform=web",!0),a.send(JSON.stringify({username:b,password:c}))}}catch(d){reject(d)}}function aW(){try{if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{if(a.readyState===XMLHttpRequest.DONE){if(validJSON(a.responseText)){let b=JSON.parse(a.responseText);"error"in b?_.error({title:"Error",description:b.error}):(ae=null,af=null,localStorage.removeItem("token"),localStorage.removeItem("username"),_.success({title:"Sedang Logout...",description:b.message}),a6(),a7(),a8(),a9(),aG.textContent="...",aL.value="",aI.value="",aJ.value="",aK.value="",al.classList.add("active"))}else _.error({title:"Error",description:"Coba Lagi."})}}),a.open("GET",$+"accounts/logout.php?platform=web&token="+ae+"&username="+af,!0),a.send()}}catch(b){reject(b)}}function aX(){if(!empty(Z)){setTimeout(()=>{s.classList.contains("active")&&s.classList.remove("active")},250),al.classList.contains("active")&&al.classList.remove("active");return}empty(ae)||empty(af)?(s.classList.contains("active")&&s.classList.remove("active"),aY()):bP(ae).then(a=>{setTimeout(()=>{s.classList.contains("active")&&s.classList.remove("active")},250),"valid"in a&&a.valid?(af=a.username,al.classList.contains("active")&&al.classList.remove("active"),"admin"===af&&O.classList.remove("hidden")):aY()}).catch(a=>{console.log(a)})}function aY(){ae=null,af=null,localStorage.removeItem("token"),localStorage.removeItem("username"),al.classList.contains("active")||(al.classList.add("active"),am.focus()),O.classList.add("hidden")}function aZ(f,g,c,d,e){t.classList.add("active"),b.style.width=c,b.style.height=d,b.style.left="calc(50% - "+c+" / 2)",b.style.top="calc(50% - "+d+" / 2)",b.classList.add("active"),ap.textContent=f,u.classList.add("hidden"),ao.innerHTML=g;let a=e?.delay;empty(a)&&(a=100),setTimeout(()=>{t.style.opacity=1,b.style.opacity=1},a),e?.closeIcon&&u.classList.remove("hidden")}function a$(){t.style.opacity=0,b.style.opacity=0,setTimeout(()=>{t.classList.remove("active"),b.classList.remove("active"),ap.textContent="Popup Title",ao.remove();let a=document.createElement("div");a.classList.add("bottom"),b.appendChild(a),ao=b.getElementsByClassName("bottom")[0]},250)}function a_(c,a){empty(a)&&(a=""),a0();let b=document.createElement("div");b.classList.add("loading-screen"),b.innerHTML='<div class="loading-icon"><div></div><div></div></div><span id="loading-text">'+a+"</span>",document.body.appendChild(b),setTimeout(()=>{b.remove()},c)}function a0(){for(let a=0;a<document.getElementsByClassName("loading-screen").length;a++)document.getElementsByClassName("loading-screen")[a].remove()}function a1(a){document.getElementById("custom-css")&&document.getElementById("custom-css").remove(),"dark"===a?(localStorage.setItem("theme","dark"),J.classList.remove("active"),document.documentElement.classList.add("dark"),document.documentElement.classList.remove("light")):(localStorage.setItem("theme","light"),J.classList.add("active"),document.documentElement.classList.remove("dark"),document.documentElement.classList.add("light"))}async function a2(a){y.classList.remove("active"),z.classList.remove("active"),A.classList.remove("active"),B.classList.remove("active"),C.classList.remove("active"),aq.classList.remove("active"),v.classList.remove("active"),ar.classList.remove("active"),as.classList.remove("active"),g.classList.remove("active"),bl().then(()=>{switch(a){case"dashboard":y.classList.add("active"),aq.classList.add("active"),aA.setAttribute("class","background dashboard"),bd();break;case"market":z.classList.add("active"),v.classList.add("active"),aA.setAttribute("class","background market"),be();break;case"holdings":A.classList.add("active"),ar.classList.add("active"),aA.setAttribute("class","background holdings"),bf();break;case"activity":B.classList.add("active"),as.classList.add("active"),aA.setAttribute("class","background activity"),bg();break;case"settings":C.classList.add("active"),g.classList.add("active"),aA.setAttribute("class","background settings")}}).catch(a=>{console.log(a)})}function a3(){window.innerWidth<=440?az.textContent="K. Pasar":az.textContent="Kapitalisasi Pasar"}function a4(){let a=parseInt(aC.getAttribute("data-page"));a>1&&(a-=1,aC.setAttribute("data-page",a),a7(),ay.textContent="Page "+a,be())}function a5(){let a=parseInt(aC.getAttribute("data-page"));a<5&&(a+=1,aC.setAttribute("data-page",a),a7(),ay.textContent="Page "+a,be())}function a6(){at.classList.add("loading"),au.classList.add("loading"),at.innerHTML='<div class="coin-wrapper loading"><span>Loading...</span></div>',au.innerHTML='<div class="coin-wrapper loading"><span>Loading...</span></div>',ba()}function a7(){aC.classList.add("loading"),aC.innerHTML='<div class="coin-wrapper loading"><span>Loading...</span></div>',ba()}function a8(){aD.classList.add("loading"),aD.innerHTML='<div class="coin-wrapper loading"><span>Loading...</span></div>',ba()}function a9(){aE.classList.add("loading"),aE.innerHTML='<div class="event-wrapper loading"><span>Loading...</span></div>',ba()}function ba(){av.textContent="...",aw.textContent="...",ax.textContent="...",aj.textContent="...",ak.textContent="...",aG.textContent="..."}async function bb(e){if(at.getElementsByClassName("coin-wrapper loading").length>0&&(at.getElementsByClassName("coin-wrapper loading")[0].remove(),at.classList.remove("loading"),"enabled"===ah.dashboardWatchlist)){let b=document.createElement("div");b.classList.add("coin-wrapper"),b.classList.add("add"),b.innerHTML='<svg width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1600 736v192q0 40-28 68t-68 28h-416v416q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-416h-416q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h416v-416q0-40 28-68t68-28h192q40 0 68 28t28 68v416h416q40 0 68 28t28 68z"/></svg><span class="add-text">Tambah Koin di daftar Favorit...',b.addEventListener("click",()=>{aR()}),at.appendChild(b)}let c=localStorage.getItem("dashboardMarketSortItem"),d=localStorage.getItem("dashboardMarketSortOrder");(empty(c)||"enabled"!==ah.dashboardWatchlist)&&(c="marketCap"),empty(d)&&(d="descending");let a=Object.keys(e);switch(c){case"coin":a.sort((a,b)=>e[b].symbol.charAt(0).localeCompare(e[a].symbol.charAt(0)));break;case"price":a.sort((a,b)=>e[b].current_price-e[a].current_price);break;case"marketCap":a.sort((a,b)=>e[b].market_cap-e[a].market_cap);break;case"change":a.sort((a,b)=>e[b].price_change_percentage_24h-e[a].price_change_percentage_24h)}"descending"!==d&&a.reverse(),a.map(j=>{let c=e[j],f=parseFloat(c.current_price);f>1&&(f=separateThousands(f));let h="dashboard-market-coin-"+c.id,d=c.market_cap;window.innerWidth<=1100&&window.innerWidth>440?d=abbreviateNumber(d,2):window.innerWidth<=440&&(d=abbreviateNumber(d,0));let i=c.name,k=c.image,b=c.price_change_percentage_24h;b=empty(b)?"-":b.toFixed(2).includes("-")?b.toFixed(2):"+"+b.toFixed(2);let l=c.symbol,a;try{if(document.getElementById(h))(a=document.getElementById(h)).getElementsByClassName("price")[0].textContent=ag[ah.currency]+f,a.getElementsByClassName("market-cap")[0].textContent=ag[ah.currency]+separateThousands(d),a.getElementsByClassName("day")[0].textContent=b+"%",b.includes("+")?(a.classList.add("positive"),a.classList.remove("negative")):b.includes("-")?(a.classList.remove("positive"),a.classList.add("negative")):(a.classList.remove("positive"),a.classList.remove("negative"));else{if((a=document.createElement("div")).id=h,a.classList.add("coin-wrapper"),b.includes("+")?a.classList.add("positive"):b.includes("-")&&a.classList.add("negative"),a.innerHTML='<img draggable="false" src="'+k+'" title="'+i+'"><span class="coin" title="'+i+'">'+l.toUpperCase()+'</span><span class="price">'+ag[ah.currency]+f+'</span><span class="market-cap">'+ag[ah.currency]+separateThousands(d)+'</span><span class="day">'+b+"%</span>","enabled"===ah.dashboardWatchlist){a.classList.add("watchlist-row");let g=document.createElement("button");g.classList.add("watchlist-button"),g.innerHTML+='<svg width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1728 647q0 22-26 48l-363 354 86 500q1 7 1 20 0 21-10.5 35.5t-30.5 14.5q-19 0-40-12l-449-236-449 236q-22 12-40 12-21 0-31.5-14.5t-10.5-35.5q0-6 2-20l86-500-364-354q-25-27-25-48 0-37 56-46l502-73 225-455q19-41 49-41t49 41l225 455 502 73q56 9 56 46z"/></svg>',g.addEventListener("click",()=>{by(c.id).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(_.success({title:"Hapus Dari Favorit",description:a.message}),g.classList.remove("active")),a6(),bd()}).catch(a=>{_.error({title:"Error",description:"Gagal."}),console.log(a)})}),a.appendChild(g)}at.appendChild(a)}}catch(m){console.log(m)}})}function bc(c,a,d){let e={dashboardMarket:"Dashboard Market",dashboardHoldings:"Dashboard Holdings",market:"Market",holdings:"Holdings",activity:"Activity"};if(["ascending","descending"].includes(d)&&Object.keys(e).includes(c)){let b=!0;switch(c){case"dashboardMarket":a6(),["coin","price","marketCap","change"].includes(a)||(b=!1,console.error("Sort order item not found."));break;case"dashboardHoldings":a6(),["coin","amount","value","change"].includes(a)||(b=!1,console.error("Sort order item not found."));break;case"market":a7(),["rank","coin","price","marketCap","change"].includes(a)||(b=!1,console.error("Sort order item not found."));break;case"holdings":a8(),["coin","amount","value","change"].includes(a)||(b=!1,console.error("Sort order item not found."));break;case"activity":a9(),["date","coin","amount","type","notes"].includes(a)||(b=!1,console.error("Sort order item not found."))}b&&(localStorage.setItem(c+"SortOrder",d),localStorage.setItem(c+"SortItem",a),"enabled"===ah.sortOrderNotification&&_.success({title:"Ganti Urutan",description:'"'+e[c]+'" urutkan menurut '+capitalizeFirstLetter(a)+" ("+capitalizeFirstLetter(d)+")."})),bd(),be(),bf(),bg()}else console.error("Sort order invalid, or list not found.")}async function bd(){!al.classList.contains("active")&&y.classList.contains("active")&&(clearInterval(aa),setTimeout(()=>{(at.classList.contains("loading")||au.classList.contains("loading"))&&bd()},5e3),"enabled"===ah.additionalDashboardColumns?aq.classList.add("additional-columns"):aq.classList.remove("additional-columns"),"enabled"===ah.dashboardWatchlist?bw().then(a=>{empty(a)?bb({}):bI(Object.keys(a).join("%2c")).then(a=>{bb(a)}).catch(a=>{console.log(a)})}).catch(a=>{console.log(a)}):bL(1,10).then(a=>{bb(a)}).catch(a=>{console.log(a)}),bp().then(a=>{ai=a.data;let b=a.data.total_market_cap[ah.currency].toFixed(0),c=a.data.market_cap_change_percentage_24h_usd.toFixed(1);window.innerWidth<=1020&&(b=abbreviateNumber(b,3)),av.textContent=ag[ah.currency]+separateThousands(b),aw.textContent=c+"%"}).catch(a=>{console.log(a)}),aa=setInterval(bd,3e4),bQ().then(async a=>{try{if(0===Object.keys(a).length&&"override"!==ah.transactionsAffectHoldings&&"mixed"!==ah.transactionsAffectHoldings)au.getElementsByClassName("coin-wrapper loading").length>0&&(au.getElementsByClassName("coin-wrapper loading")[0].innerHTML="<span>Portofolio Kosong...</span>");else{let b;if("mixed"===ah.transactionsAffectHoldings){let c=await bS();!empty(c)&&(b=bV(c),Object.keys(b).map(c=>{c in a||(a[c]={amount:0,symbol:b[c].symbol})}))}else if("override"===ah.transactionsAffectHoldings){let d=await bS();!empty(d)&&(b=bV(d),a={},Object.keys(b).map(c=>{b[c].amount>0&&(a[c]={amount:b[c].amount,symbol:b[c].symbol})}))}let f=0;empty(a)?au.getElementsByClassName("coin-wrapper loading").length>0&&(au.getElementsByClassName("coin-wrapper loading")[0].innerHTML="<span>Portofolio Kosong...</span>"):bR(a).then(e=>{au.getElementsByClassName("coin-wrapper loading").length>0&&(au.getElementsByClassName("coin-wrapper loading")[0].remove(),au.classList.remove("loading"));let c=localStorage.getItem("dashboardHoldingsSortItem"),d=localStorage.getItem("dashboardHoldingsSortOrder");empty(c)&&(c="coin"),empty(d)&&(d="descending");let a=Object.keys(e);switch(c){case"coin":a.sort((a,b)=>e[b].symbol.charAt(0).localeCompare(e[a].symbol.charAt(0)));break;case"amount":a.sort((a,b)=>e[b].amount-e[a].amount);break;case"value":a.sort((a,b)=>e[b].value-e[a].value);break;case"change":a.sort((a,b)=>parseFloat(e[b].change)-parseFloat(e[a].change))}"descending"!==d&&a.reverse(),a.map(i=>{let d=e[i],j="dashboard-holdings-coin-"+i,k=d.image,g=d.amount,l=d.symbol,c=d.value.toFixed(2);!empty(b)&&"mixed"===ah.transactionsAffectHoldings&&i in b&&(g=parseFloat(g)+b[i].amount,c=(d.price*g).toFixed(2),f+=parseFloat(c)),window.innerWidth<=600&&window.innerWidth>440?c=abbreviateNumber(parseFloat(c),2):window.innerWidth<=440&&(c=abbreviateNumber(parseFloat(c),0));let h=d.change.includes("-")?d.change+"%":"+"+d.change+"%";if(g<0&&(g=0),c<0&&(c=0),0!==c){let a;try{document.getElementById(j)?((a=document.getElementById(j)).getElementsByClassName("amount")[0].textContent=separateThousands(g),a.getElementsByClassName("value")[0].textContent=ag[ah.currency]+separateThousands(c),h.includes("+")?(a.classList.add("positive"),a.classList.remove("negative")):h.includes("-")?(a.classList.remove("positive"),a.classList.add("negative")):(a.classList.remove("positive"),a.classList.remove("negative"))):((a=document.createElement("div")).id=j,a.classList.add("coin-wrapper"),h.includes("+")?a.classList.add("positive"):h.includes("-")&&a.classList.add("negative"),a.innerHTML='<img draggable="false" src="'+k+'"><span class="coin">'+l.toUpperCase()+'</span><span class="amount">'+separateThousands(g)+'</span><span class="value">'+ag[ah.currency]+separateThousands(c)+'</span><span class="day">'+h+"</span>",au.appendChild(a))}catch(m){console.log(m)}}}),f>0&&(ai.totalValue=f),window.innerWidth>480?ax.textContent=ag[ah.currency]+separateThousands(ai.totalValue.toFixed(2)):ax.textContent=ag[ah.currency]+abbreviateNumber(ai.totalValue,2)}).catch(a=>{console.log(a)})}}catch(e){console.log(e)}}).catch(a=>{console.log(a)}))}function be(){if(!al.classList.contains("active")&&z.classList.contains("active")){clearInterval(ab),aB.classList.remove("active"),setTimeout(()=>{aC.classList.contains("loading")&&be()},5e3);let a=parseInt(aC.getAttribute("data-page"));empty(a)&&(a=1),bL(a,100).then(c=>{aC.getElementsByClassName("coin-wrapper loading").length>0&&(aC.getElementsByClassName("coin-wrapper loading")[0].remove(),aC.classList.remove("loading"));let b=Object.keys(c);b.sort((a,d)=>c[b[d]].market_cap-c[b[a]].market_cap);let d=1;b.map(l=>{let f=c[l],h=parseFloat(f.current_price);h>1&&(h=separateThousands(h));let i="market-coin-"+f.id,g=f.market_cap;window.innerWidth<=960&&window.innerWidth>440?g=abbreviateNumber(g,2):window.innerWidth<=440&&(g=abbreviateNumber(g,0));let j=(a-1)*100+d;1===a&&(j=d);let k=f.name,m=f.image,e=f.price_change_percentage_24h;e=empty(e)?"-":e.toFixed(2).includes("-")?e.toFixed(2):"+"+e.toFixed(2);let n=f.symbol,b;try{document.getElementById(i)?((b=document.getElementById(i)).getElementsByClassName("price")[0].textContent=ag[ah.currency]+h,b.getElementsByClassName("market-cap")[0].textContent=ag[ah.currency]+separateThousands(g),b.getElementsByClassName("day")[0].textContent=e+"%",e.includes("+")?(b.classList.add("positive"),b.classList.remove("negative")):e.includes("-")?(b.classList.remove("positive"),b.classList.add("negative")):(b.classList.remove("positive"),b.classList.remove("negative"))):((b=document.createElement("div")).id=i,b.classList.add("coin-wrapper"),e.includes("+")?b.classList.add("positive"):e.includes("-")&&b.classList.add("negative"),b.innerHTML='<span class="rank">'+j+'</span><img draggable="false" src="'+m+'" title="'+k+'"><span class="coin" title="'+k+'">'+n.toUpperCase()+'</span><span class="price">'+ag[ah.currency]+h+'</span><span class="market-cap">'+ag[ah.currency]+separateThousands(g)+'</span><span class="day">'+e+"%</span>",b.addEventListener("click",()=>{aS(f.id,n,f.current_price)}),aC.appendChild(b)),d+=1,aB.classList.add("active")}catch(o){console.log(o)}}),bp().then(a=>{ai=a.data;let b=a.data.total_market_cap[ah.currency].toFixed(0),c=a.data.total_volume[ah.currency].toFixed(0);window.innerWidth<=1020&&(b=abbreviateNumber(b,3),c=abbreviateNumber(c,0)),aj.textContent=ag[ah.currency]+separateThousands(b),ak.textContent=ag[ah.currency]+separateThousands(c)}).catch(a=>{console.log(a)}),ab=setInterval(()=>{be()},3e4)}).catch(a=>{console.log(a)})}}async function bf(){(!al.classList.contains("active")&&A.classList.contains("active")||"view"===X.searchParams.get("access"))&&(clearInterval(ac),aB.classList.remove("active"),setTimeout(()=>{aD.classList.contains("loading")&&bf()},5e3),bQ().then(async a=>{try{if(0===Object.keys(a).length&&"override"!==ah.transactionsAffectHoldings&&"mixed"!==ah.transactionsAffectHoldings)a8(),aD.getElementsByClassName("coin-wrapper loading").length>0&&(aD.getElementsByClassName("coin-wrapper loading")[0].innerHTML="<span>Portofolio Kosong...</span>");else{let b;if("mixed"===ah.transactionsAffectHoldings){let c=await bS();!empty(c)&&(b=bV(c),Object.keys(b).map(c=>{c in a||(a[c]={amount:0,symbol:b[c].symbol})}))}else if("override"===ah.transactionsAffectHoldings){let d=await bS();!empty(d)&&(b=bV(d),a={},Object.keys(b).map(c=>{b[c].amount>0&&(a[c]={amount:b[c].amount,symbol:b[c].symbol})}))}let f=0;empty(a)?(a8(),aD.getElementsByClassName("coin-wrapper loading").length>0&&(aD.getElementsByClassName("coin-wrapper loading")[0].innerHTML="<span>Portofolio Kosong...</span>")):bR(a).then(a=>{aD.getElementsByClassName("coin-wrapper loading").length>0&&(aD.getElementsByClassName("coin-wrapper loading")[0].remove(),aD.classList.remove("loading"));let c={};Object.keys(a).map(j=>{let g=a[j],l="holdings-coin-"+j,n=g.image,h=g.amount,o=g.symbol,e=g.value.toFixed(2);c[j]={amount:h,value:e};let m=!0;window.innerWidth<=600&&window.innerWidth>440?e=abbreviateNumber(e,2):window.innerWidth<=440&&(e=abbreviateNumber(e,0));let i=g.change.includes("-")?g.change+"%":"+"+g.change+"%";if(!empty(b)&&("mixed"===ah.transactionsAffectHoldings?j in b&&(h=parseFloat(h)+b[j].amount,e=(g.price*h).toFixed(2),f+=parseFloat(e),m=!1):"override"===ah.transactionsAffectHoldings&&(m=!1)),h<0&&(h=0),e<0&&(e=0),0!==e){let d;try{if(document.getElementById(l))(d=document.getElementById(l)).getElementsByClassName("amount")[0].textContent=separateThousands(h),d.getElementsByClassName("value")[0].textContent=ag[ah.currency]+separateThousands(e),d.getElementsByClassName("day")[0].textContent=i,i.includes("+")?(d.classList.add("positive"),d.classList.remove("negative")):i.includes("-")?(d.classList.remove("positive"),d.classList.add("negative")):(d.classList.remove("positive"),d.classList.remove("negative"));else{if((d=document.createElement("div")).id=l,d.classList.add("coin-wrapper"),i.includes("+")?d.classList.add("positive"):i.includes("-")&&d.classList.add("negative"),d.innerHTML='<img draggable="false" src="'+n+'"><span class="coin">'+o.toUpperCase()+'</span><span class="amount">'+separateThousands(h)+'</span><span class="value">'+ag[ah.currency]+separateThousands(e)+'</span><span class="day">'+i+"</span>",m){let k=document.createElement("div");k.classList.add("more"),k.innerHTML='<svg class="more-icon" width="1792" height="1792" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path class="more-path" d="M576 736v192q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h192q40 0 68 28t28 68zm512 0v192q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h192q40 0 68 28t28 68zm512 0v192q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h192q40 0 68 28t28 68z"/></svg>',k.addEventListener("click",a=>{aF.setAttribute("data-coin",j),aF.setAttribute("data-symbol",g.symbol.toUpperCase()),aF.setAttribute("data-amount",h),aF.classList.remove("hidden"),aF.style.top=a.clientY-2+"px",aF.style.left=a.clientX-2-200+"px",window.innerWidth<=1230&&window.innerWidth>700&&(aF.style.left=a.clientX-2-200-aF.clientWidth+"px"),window.innerWidth<=1120&&window.innerWidth>700?aF.style.left=a.clientX-2-100-aF.clientWidth+"px":window.innerWidth<=700&&(aF.style.left=a.clientX-2-aF.clientWidth+"px")}),d.appendChild(k)}"override"===ah.transactionsAffectHoldings&&(d.classList.add("clickable"),d.addEventListener("click",()=>{bh(j)})),aD.appendChild(d)}}catch(p){console.log(p)}}}),f>0&&(ai.totalValue=f),window.innerWidth>480?aG.textContent=ag[ah.currency]+separateThousands(ai.totalValue.toFixed(2)):aG.textContent=ag[ah.currency]+abbreviateNumber(ai.totalValue,2),localStorage.setItem("holdingsData",JSON.stringify(c))}).catch(a=>{console.log(a)})}}catch(e){console.log(e)}}).catch(a=>{console.log(a)}),ac=setInterval(bf,3e4))}function bg(){!al.classList.contains("active")&&B.classList.contains("active")&&(clearInterval(ad),aB.classList.remove("active"),setTimeout(()=>{aE.classList.contains("loading")&&bg()},5e3),bS().then(a=>{try{0===Object.keys(a).length?(a9(),aE.getElementsByClassName("event-wrapper loading").length>0&&(aE.getElementsByClassName("event-wrapper loading")[0].innerHTML="<span>Tidak ada catatan Transaksi...</span>")):(aE.getElementsByClassName("event-wrapper loading").length>0&&(aE.getElementsByClassName("event-wrapper loading")[0].remove(),aE.classList.remove("loading")),a=bU(a),Object.keys(a).map(e=>{let c=a[e],j="activity-event-"+e,f=c.symbol.toUpperCase(),g=c.date,h=c.amount,k=c.fee,i=c.notes,d=capitalizeFirstLetter(c.type),l=c.exchange,m=c.pair,n=c.price,o=c.from,p=c.to,b;try{document.getElementById(j)?((b=document.getElementById(j)).setAttribute("data-tx",e),b.setAttribute("data-id",c.id),b.setAttribute("data-symbol",f),b.setAttribute("data-date",g),b.setAttribute("data-amount",h),b.setAttribute("data-fee",k),b.setAttribute("data-notes",i),b.setAttribute("data-type",d),"transfer"===d.toLowerCase()?(b.setAttribute("data-from",o),b.setAttribute("data-to",p)):(b.setAttribute("data-exchange",l),b.setAttribute("data-pair",m),b.setAttribute("data-price",n)),b.getElementsByClassName("date")[0].textContent=g,b.getElementsByClassName("symbol")[0].textContent=f,b.getElementsByClassName("amount")[0].textContent=separateThousands(h),b.getElementsByClassName("type")[0].textContent=d,b.getElementsByClassName("notes")[0].textContent=i):((b=document.createElement("div")).id=j,b.setAttribute("data-tx",e),b.setAttribute("data-id",c.id),b.setAttribute("data-symbol",f),b.setAttribute("data-date",g),b.setAttribute("data-amount",h),b.setAttribute("data-fee",k),b.setAttribute("data-notes",i),b.setAttribute("data-type",d),"transfer"===d.toLowerCase()?(b.setAttribute("data-from",o),b.setAttribute("data-to",p)):(b.setAttribute("data-exchange",l),b.setAttribute("data-pair",m),b.setAttribute("data-price",n)),b.classList.add("event-wrapper"),b.innerHTML='<span class="date">'+g+'</span><span class="symbol">'+f+'</span><span class="amount">'+separateThousands(h)+'</span><span class="type">'+d+'</span><span class="notes">'+i+"</span>",b.addEventListener("click",()=>{bv("update",{txID:e})}),aE.appendChild(b))}catch(q){console.log(q)}}))}catch(b){console.log(b)}}).catch(a=>{console.log(a)}),ad=setInterval(bg,3e4))}function bh(a){if("override"===ah.transactionsAffectHoldings){let b=null;bS().then(c=>{c=bT(c);let f={},d=0,g=previousYear(new Date).getTime()/1e3;for(let e=0;e<366;e++){let h=(g+d)*1e3;f[formatDate(new Date(h)).replaceAll(" ","")]={holdingsValue:0},d+=86400}let i=0;Object.keys(c).map(j=>{let d=c[j],e=d.id;if(a===e){let h=parseFloat(d.amount),k=1e3*parseInt(d.time),g=formatDate(new Date(k)).replaceAll(" ",""),l=previousYear(new Date);k>l&&"transfer"!==d.type&&(e in f[g]?"buy"===d.type?f[g][e]+=h:f[g][e]-=h:"buy"===d.type?f[g][e]=h:f[g][e]=-h),0===i&&(b=c[j]),i++}}),a_(8e3,"This might take a while... Don't touch anything."),bH(a,ah.currency,previousYear(new Date),new Date).then(g=>{a0(),a_(1400,"Generating chart...");let h=Object.keys(g),j={};h.map(a=>{a in j||(j[a]={});let c=g[a].prices;for(let b=0;b<c.length;b++){let d=c[b][0],e=c[b][1],f=formatDate(new Date(d)).replaceAll(" ","");j[a][f]=e}});let d=Object.keys(f),i;for(let c=0;c<d.length;c++){let e=f[d[c-1]],k=f[d[c]];c-1>=0&&Object.keys(e).length>1&&Object.keys(e).map(a=>{"holdingsValue"!==a&&(empty(i)&&(i=c-1),e[a]<0&&(f[d[c-1]][a]=0),a in k?f[d[c]][a]=f[d[c]][a]+e[a]:f[d[c]][a]=e[a])}),Object.keys(f[d[c]]).map(a=>{if("holdingsValue"!==a){let b=f[d[c]][a]*j[a][d[c]];f[d[c]].holdingsValue+=b}})}empty(b)?_.alert({title:"Alert",description:"Kosong."}):aU(a,b,f,i)}).catch(a=>{console.log(a)})})}}async function bi(c,d,e,l,f,m){let a=document.createElement("canvas");a.id="chart-canvas",a.classList.add("chart-canvas");let b=a.getContext("2d").createLinearGradient(1e3,0,300,0);b.addColorStop(0,"#feac5e"),b.addColorStop(.5,"#c779d0"),b.addColorStop(1,"#4bc0c8");let g=[],h=[],n=[],o=[],p=[],q=[];if("enabled"===ah.showTransactionsOnCharts){let i=await bS();Object.keys(i).map(b=>{let a=i[b];if(a.symbol.toUpperCase()===m?.symbol.toUpperCase())try{"buy"===a.type.toLowerCase()?(g.push(new Date(Date.parse(a.date))),n.push(formatDateHuman(new Date(Date.parse(a.date)))),p.push(a.amount)):"sell"===a.type.toLowerCase()&&(h.push(new Date(Date.parse(a.date))),o.push(formatDateHuman(new Date(Date.parse(a.date)))),q.push(a.amount))}catch(c){console.log(c)}})}let j=g.map(function(a,b){return{type:"line",id:"line-buy-"+b,mode:"vertical",scaleID:"x-axis-0",value:a,borderColor:"#67b26f",borderWidth:2.5}}),k=h.map(function(a,b){return{type:"line",id:"line-sell-"+b,mode:"vertical",scaleID:"x-axis-0",value:a,borderColor:"#e94057",borderWidth:2.5}});new Chart(a,{type:"line",data:{labels:e,datasets:[{label:d,backgroundColor:"rgba(0,0,0,0)",borderColor:b,data:f,pointRadius:1,pointHoverRadius:6},]},options:{events:["mousemove","mouseout","touchstart","touchmove"],responsive:!0,legend:{display:!1},hover:{mode:"index",intersect:!1},scales:{xAxes:[{beginAtZero:!0,gridLines:{zeroLineColor:"dark"===ah.theme?"rgba(255,255,255,0.075)":"rgba(0,0,0,0.1)",color:"dark"===ah.theme?"rgba(255,255,255,0.075)":"rgba(0,0,0,0.1)"},ticks:{autoSkip:!0,maxTicksLimit:12,fontColor:"dark"===ah.theme?"rgba(255,255,255,0.9)":"rgb(75,75,75)"},type:"time",time:{unit:"month"}},],yAxes:[{beginAtZero:!0,gridLines:{color:"dark"===ah.theme?"rgba(255,255,255,0.075)":"rgba(0,0,0,0.1)"},ticks:{fontColor:"dark"===ah.theme?"rgba(255,255,255,0.9)":"rgb(75,75,75)"}},]},tooltips:{displayColors:!1,intersect:!1,callbacks:{title:function(){return""},label:function(a){let b=f[a.index];if(b>1&&(b=separateThousands(b.toFixed(2))),n.includes(l[a.index])){let c=p[n.indexOf(l[a.index])];return[l[a.index],"Bought "+c+" @ "+ag[ah.currency]+b,]}if(o.includes(l[a.index])){let d=q[o.indexOf(l[a.index])];return[l[a.index],"Sold "+d+" @ "+ag[ah.currency]+b,]}return[l[a.index],ag[ah.currency]+b,]}}},annotation:{drawTime:"beforeDatasetsDraw",annotations:[...j,...k]}}}),c.innerHTML="",c.appendChild(a)}async function bj(c,d,e,g,f){let a=document.createElement("canvas");a.id="chart-canvas",a.classList.add("chart-canvas");let b=a.getContext("2d").createLinearGradient(1e3,0,300,0);b.addColorStop(0,"#11998e"),b.addColorStop(1,"#38ef7d"),new Chart(a,{type:"line",data:{labels:e,datasets:[{label:d,backgroundColor:"rgba(0,0,0,0)",borderColor:b,data:f,pointRadius:1,pointHoverRadius:6},]},options:{events:["mousemove","mouseout","touchstart","touchmove"],responsive:!0,legend:{display:!1},hover:{mode:"index",intersect:!1},scales:{xAxes:[{beginAtZero:!0,gridLines:{zeroLineColor:"dark"===ah.theme?"rgba(255,255,255,0.075)":"rgba(0,0,0,0.1)",color:"dark"===ah.theme?"rgba(255,255,255,0.075)":"rgba(0,0,0,0.1)"},ticks:{autoSkip:!0,maxTicksLimit:12,fontColor:"dark"===ah.theme?"rgba(255,255,255,0.9)":"rgb(75,75,75)"},type:"time",time:{unit:"month"}},],yAxes:[{beginAtZero:!0,gridLines:{color:"dark"===ah.theme?"rgba(255,255,255,0.075)":"rgba(0,0,0,0.1)"},ticks:{fontColor:"dark"===ah.theme?"rgba(255,255,255,0.9)":"rgb(75,75,75)"}},]},tooltips:{displayColors:!1,intersect:!1,callbacks:{title:function(){return""},label:function(b){let a=f[b.index];return a>1&&(a=separateThousands(a.toFixed(2))),[g[b.index],ag[ah.currency]+a,]}}}}}),c.innerHTML="",c.appendChild(a)}function bk(a){switch(a){case"transactionsAffectHoldings":a6(),a8();break;case"dashboardWatchlist":case"additionalDashboardColumns":a6()}b_()}function bl(){let a=document.getElementsByClassName("noapi-visible");if(empty(Z))for(let b=0;b<a.length;b++)a[b].classList.add("hidden");else for(let c=0;c<a.length;c++)a[c].classList.remove("hidden");return new Promise((a,b)=>{aX(),bm().then(h=>{if((ah=h).currency=empty(localStorage.getItem("currency"))?"usd":localStorage.getItem("currency"),ah.theme=empty(localStorage.getItem("theme"))?"light":localStorage.getItem("theme"),ah.coinBackdrop=empty(localStorage.getItem("coinBackdrop"))?"disabled":localStorage.getItem("coinBackdrop"),ah.transactionsAffectHoldings=empty(localStorage.getItem("transactionsAffectHoldings"))?"disabled":localStorage.getItem("transactionsAffectHoldings"),ah.showTransactionsOnCharts=empty(localStorage.getItem("showTransactionsOnCharts"))?"disabled":localStorage.getItem("showTransactionsOnCharts"),ah.highlightPriceChange=empty(localStorage.getItem("highlightPriceChange"))?"disabled":localStorage.getItem("highlightPriceChange"),ah.dashboardWatchlist=empty(localStorage.getItem("dashboardWatchlist"))?"disabled":localStorage.getItem("dashboardWatchlist"),ah.sortOrderNotification=empty(localStorage.getItem("sortOrderNotification"))?"disabled":localStorage.getItem("sortOrderNotification"),ah.additionalDashboardColumns=empty(localStorage.getItem("additionalDashboardColumns"))?"disabled":localStorage.getItem("additionalDashboardColumns"),ah.importTokens=empty(localStorage.getItem("importTokens"))?"add":localStorage.getItem("importTokens"),ah.defaultPage=empty(localStorage.getItem("defaultPage"))?"market":localStorage.getItem("defaultPage"),a1(ah.theme),aL.value=ah.pin,!empty(ah.css)){aH.value=ah.css;let f="html.light, html.dark { "+aH.value+"}";if(document.getElementById("custom-css"))document.getElementById("custom-css").textContent=f;else{let b=document.createElement("style");b.id="custom-css",b.textContent=f,document.head.appendChild(b)}localStorage.setItem("theme","custom")}aH.value=aH.value.replaceAll("	","");for(let c=0;c<i.length;c++)i[c].classList.remove("active");for(let d=0;d<j.length;d++)j[d].classList.remove("active");let g=[];for(let e=0;e<document.getElementsByClassName("settings-choices-wrapper").length;e++)g.push(document.getElementsByClassName("settings-choices-wrapper")[e].getAttribute("data-key"));g.map(c=>{for(let a=0;a<i.length;a++)i[a].getAttribute("data-value")===ah[c]&&i[a].parentElement.getAttribute("data-key")===c&&i[a].classList.add("active");for(let b=0;b<j.length;b++)j[b].getAttribute("data-value")===ah[c]&&j[b].parentElement.getAttribute("data-key")===c&&j[b].classList.add("active")}),"enabled"===ah.coinBackdrop?(at.classList.add("backdrop"),au.classList.add("backdrop"),aC.classList.add("backdrop"),aD.classList.add("backdrop")):(at.classList.remove("backdrop"),au.classList.remove("backdrop"),aC.classList.remove("backdrop"),aD.classList.remove("backdrop")),at.classList.remove("highlight-row"),au.classList.remove("highlight-row"),aC.classList.remove("highlight-row"),aD.classList.remove("highlight-row"),at.classList.remove("highlight-text"),au.classList.remove("highlight-text"),aC.classList.remove("highlight-text"),aD.classList.remove("highlight-text"),"row"===ah.highlightPriceChange?(at.classList.add("highlight-row"),au.classList.add("highlight-row"),aC.classList.add("highlight-row"),aD.classList.add("highlight-row")):"text"===ah.highlightPriceChange&&(at.classList.add("highlight-text"),au.classList.add("highlight-text"),aC.classList.add("highlight-text"),aD.classList.add("highlight-text")),"override"===ah.transactionsAffectHoldings?D.classList.add("clickable"):D.classList.remove("clickable"),aM.value=window.location.href.replaceAll("index.html","")+"index.html?access=view&pin="+ah.pin,b_(),a()}).catch(a=>{b(a),console.log(a)})})}function bm(){return new Promise((a,c)=>{try{if(empty(Z)){if(empty(localStorage.getItem("NoAPI"))||!empty(localStorage.getItem("token"))){let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?a(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("GET",$+"settings/read.php?token="+ae+"&username="+af,!0),b.send()}else!empty(localStorage.getItem("NoAPI"))&&validJSON(localStorage.getItem("NoAPI"))?a(JSON.parse(localStorage.getItem("NoAPI")).settings):c(e)}else a(Z.getData().settings)}catch(d){!empty(localStorage.getItem("NoAPI"))&&validJSON(localStorage.getItem("NoAPI"))?a(JSON.parse(localStorage.getItem("NoAPI")).settings):c(d)}})}function bn(a,b){return new Promise((f,d)=>{try{let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?f(JSON.parse(c.responseText)):d("Invalid JSON."))}),c.open("PUT",$+"accounts/update.php",!0),c.send(JSON.stringify({username:af,currentPassword:a,newPassword:b}))}catch(e){d(e)}})}function bo(a,b){return new Promise((d,e)=>{try{if(empty(Z)){let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?d(JSON.parse(c.responseText)):e("Invalid JSON."))}),c.open("PUT",$+"settings/update.php",!0),c.send(JSON.stringify({username:af,token:ae,key:a,value:b}))}else d(Z.updateSettings(a,b))}catch(f){e(f)}})}function bp(){return new Promise((d,b)=>{try{console.log("Fetching Global Market Data...");let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{a.readyState===XMLHttpRequest.DONE&&(validJSON(a.responseText)?d(JSON.parse(a.responseText)):b("Invalid JSON."))}),a.open("GET","https://api.coingecko.com/api/v3/global",!0),a.send()}catch(c){b(c)}})}function bq(a,b){bE(a).then(c=>{empty(c.error)?br(a,c.symbol,b).then(a=>{a8(),"message"in a?(a$(),_.success({title:"Portofolio Ditambahkan",description:a.message})):_.error({title:"Error",description:a.error}),bf()}).catch(a=>{_.error({title:"Error",description:"Portofolio tidak dapat ditambahkan."})}):_.error({title:"Error",description:"Koin tidak ditemukan."})}).catch(a=>{console.log(a)})}function br(a,b,c){return new Promise((e,f)=>{try{if(empty(Z)){let d=new XMLHttpRequest;d.addEventListener("readystatechange",()=>{d.readyState===XMLHttpRequest.DONE&&(validJSON(d.responseText)?e(JSON.parse(d.responseText)):f("Invalid JSON."))}),d.open("POST",$+"holdings/create.php",!0),d.send(JSON.stringify({username:af,token:ae,id:a,symbol:b,amount:c}))}else e(Z.createHoldings(a,b,c))}catch(g){f(g)}})}function bs(a,b){return new Promise((d,e)=>{try{if(empty(Z)){let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?d(JSON.parse(c.responseText)):e("Invalid JSON."))}),c.open("PUT",$+"holdings/update.php",!0),c.send(JSON.stringify({username:af,token:ae,id:a,amount:b}))}else d(Z.updateHoldings(a,b))}catch(f){e(f)}})}function bt(a){return new Promise((c,d)=>{try{if(empty(Z)){let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?c(JSON.parse(b.responseText)):d("Invalid JSON."))}),b.open("DELETE",$+"holdings/delete.php",!0),b.send(JSON.stringify({username:af,token:ae,id:a}))}else c(Z.deleteHoldings(a))}catch(e){d(e)}})}function bu(c){if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{if(a.readyState===XMLHttpRequest.DONE){if(validJSON(a.responseText)){let b=JSON.parse(a.responseText);"error"in b?_.error({title:"Error",description:b.error}):_.success({title:"portoflio berhasil di Import",description:b.message})}else _.error({title:"Error",description:"Coba Lagi."})}}),a.open("POST",$+"holdings/import.php",!0),a.send(JSON.stringify({username:af,token:ae,rows:c}))}else{let b=Z.importHoldings(c);"error"in b?_.error({title:"Error",description:b.error}):_.success({title:"Portoflio berhasil di import",description:b.message})}}function bv(d,g){let a="";a+='<input id="popup-symbol" placeholder="ID koin... (e.g. BTC)">',a+='<input id="popup-date" placeholder="tanggal... (e.g. 2021/04/18 04:20)">',a+='<div id="popup-choice"><button id="popup-buy" data-value="buy" class="choice active">Beli</button>',a+='<button id="popup-sell" data-value="sell" class="choice">Jual</button>',a+='<button id="popup-transfer" data-value="transfer" class="choice">Transfer</button></div>',a+='<input id="popup-amount" placeholder="Jumlah... (e.g. 2.5)" type="number">',a+='<input id="popup-fee" placeholder="Pajak... (e.g. 0.25)" type="number">',a+='<input id="popup-notes" placeholder="catatan... (e.g. Rent)">',a+='<input id="popup-exchange" placeholder="Tempat... (e.g. Coinbase)">',a+='<input id="popup-pair" placeholder="Target Koin... (e.g. BTC/USDT)">',a+='<input id="popup-price" placeholder="Harga... (e.g. 59000)">',a+='<input id="popup-from" class="hidden" placeholder="Dari... (e.g. Kraken)">',a+='<input id="popup-to" class="hidden" placeholder="Kepada... (e.g. Cold Wallet)">',"create"!==d&&(a+='<input id="popup-id" class="hidden" placeholder="ID... (e.g. Bitcoin)">',a+='<button class="delete" id="popup-delete">Hapus Transaksi</button>'),aZ("create"===d?"Catatan transaksi":"Ubah Transaksi",a+='<button class="reject" id="popup-cancel">Batal</button><button class="resolve" id="popup-confirm">Konfirmasi</button>',"300px","360px");let h,j=document.getElementById("popup-symbol"),i=document.getElementById("popup-date"),k=document.getElementById("popup-amount"),l=document.getElementById("popup-fee"),m=document.getElementById("popup-notes"),n=document.getElementById("popup-exchange"),o=document.getElementById("popup-pair"),p=document.getElementById("popup-price"),q=document.getElementById("popup-from"),r=document.getElementById("popup-to");flatpickr(i,{enableTime:!0,dateFormat:"Y-m-d H:i",allowInput:!0}),"create"!==d&&(h=document.getElementById("popup-id"));let f=document.getElementById("popup-choice").getElementsByClassName("choice");for(let e=0;e<f.length;e++)if(f[e].addEventListener("click",()=>{for(let a=0;a<f.length;a++)f[a].classList.remove("active");f[e].classList.add("active"),"transfer"===f[e].getAttribute("data-value")?(n.classList.add("hidden"),o.classList.add("hidden"),p.classList.add("hidden"),q.classList.remove("hidden"),r.classList.remove("hidden")):(n.classList.remove("hidden"),o.classList.remove("hidden"),p.classList.remove("hidden"),q.classList.add("hidden"),r.classList.add("hidden"))}),"create"!==d){let s=document.getElementById("activity-event-"+g.txID);f[e].getAttribute("data-value")===s.getAttribute("data-type").toLowerCase()&&f[e].click()}if("create"!==d){let c=document.getElementById("activity-event-"+g.txID);h.value=c.getAttribute("data-id"),j.value=c.getAttribute("data-symbol"),i.value=c.getAttribute("data-date"),k.value=c.getAttribute("data-amount"),l.value=c.getAttribute("data-fee"),m.value=c.getAttribute("data-notes"),"transfer"===c.getAttribute("data-type").toLowerCase()?(q.value=c.getAttribute("data-from"),r.value=c.getAttribute("data-to")):(n.value=c.getAttribute("data-exchange"),o.value=c.getAttribute("data-pair"),p.value=c.getAttribute("data-price")),document.getElementById("popup-delete").addEventListener("click",()=>{bB(g.txID).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(a$(),a9(),bg(),"disabled"!==ah.transactionsAffectHoldings&&a8(),_.success({title:"transaksi dihapus",description:a.message}))}).catch(a=>{console.log(a)})})}document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{let f=j.value,u=i.value,s=k.value,t=l.value,v=m.value,w=document.getElementById("popup-choice").getElementsByClassName("active")[0].getAttribute("data-value"),x=n.value,y=o.value,a=p.value,z=q.value,A=r.value;if(isNaN(s)||isNaN(t)||isNaN(a)&&!empty(a))_.error({title:"Error",description:"data yang di input, fee, and price fields harus dalam bentuk angka."});else{let c="symbol",e=f.trim().toLowerCase();"update"===d&&(c="id",e=h.value.trim().toLowerCase()),bF(c,e).then(c=>{_.alert({title:"Checking...",description:"mengecek koin."});for(let e=0;e<document.getElementsByClassName("popup-list").length;e++)document.getElementsByClassName("popup-list")[e].remove();if("id"in c){let i=c.id;"create"===d?bC(i,f,u,s,t,v,w,x,y,a,z,A):bA(g.txID,i,f,u,s,t,v,w,x,y,a,z,A).then(a=>{a$(),a9(),bg(),"disabled"!==ah.transactionsAffectHoldings&&a8(),_.success({title:"Transaksi diperbarui",description:a.message})}).catch(a=>{console.log(a)})}else if("matches"in c){_.info({title:"Hasil Duplikat",description:"terdapat "+c.matches.length+" koin dengan simbol tersebut. pilih salah satu.",duration:8e3});let j=document.createElement("div");j.classList.add("popup-list");let h=c.matches;Object.keys(h).map(f=>{let c=h[f],e=Object.keys(c)[0],i=c[e],b=document.createElement("div");b.innerHTML='<span class="title">'+e.toUpperCase()+'</span><span class="subtitle">'+capitalizeFirstLetter(i)+"</span>",b.addEventListener("click",()=>{"create"===d?bC(i,e,u,s,t,v,w,x,y,a,z,A):bA(g.txID,i,e,u,s,t,v,w,x,y,a,z,A).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(a$(),a9(),bg(),_.success({title:"transaksi diperbarui",description:a.message}))}).catch(a=>{console.log(a)})}),j.appendChild(b)});let k=40*h;h.length>=3&&(k=120);let l=360+k+20;b.style.height=l+"px",b.style.top="calc(50% - "+l+"px / 2)",insertAfter(j,r)}else _.error({title:"Error",description:"gagal."})}).catch(a=>{console.log(a)})}})}function bw(){return new Promise((b,c)=>{try{if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{a.readyState===XMLHttpRequest.DONE&&(validJSON(a.responseText)?b(JSON.parse(a.responseText)):c("Invalid JSON."))}),a.open("GET",$+"watchlist/read.php?token="+ae+"&username="+af,!0),a.send()}else b(Z.readWatchlist())}catch(d){c(d)}})}function bx(a,b){return new Promise((d,e)=>{try{if(empty(Z)){let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?d(JSON.parse(c.responseText)):e("Invalid JSON."))}),c.open("POST",$+"watchlist/create.php",!0),c.send(JSON.stringify({username:af,token:ae,id:a,symbol:b}))}else d(Z.createWatchlist(a,b))}catch(f){e(f)}})}function by(a){return new Promise((c,d)=>{try{if(empty(Z)){let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?c(JSON.parse(b.responseText)):d("Invalid JSON."))}),b.open("DELETE",$+"watchlist/delete.php",!0),b.send(JSON.stringify({username:af,token:ae,id:a}))}else c(Z.deleteWatchlist(a))}catch(e){d(e)}})}function bz(a,b,c,d,e,f,g,h,i,j,k,l){return new Promise((n,o)=>{try{if(empty(Z)){let m=new XMLHttpRequest;m.addEventListener("readystatechange",()=>{m.readyState===XMLHttpRequest.DONE&&(validJSON(m.responseText)?n(JSON.parse(m.responseText)):o("Invalid JSON."))}),m.open("POST",$+"activity/create.php",!0),m.send(JSON.stringify({username:af,token:ae,id:a,symbol:b,date:c,amount:d,fee:e,notes:f,type:g,exchange:h,pair:i,price:j,from:k,to:l}))}else n(Z.createActivity(a,b,c,g,d,e,f,h,i,j,k,l))}catch(p){o(p)}})}function bA(a,b,c,d,e,f,g,h,i,j,k,l,m){return new Promise((o,p)=>{try{if(empty(Z)){let n=new XMLHttpRequest;n.addEventListener("readystatechange",()=>{n.readyState===XMLHttpRequest.DONE&&(validJSON(n.responseText)?o(JSON.parse(n.responseText)):p("Invalid JSON."))}),n.open("PUT",$+"activity/update.php",!0),n.send(JSON.stringify({username:af,token:ae,txID:a,id:b,symbol:c,date:d,amount:e,fee:f,notes:g,type:h,exchange:i,pair:j,price:k,from:l,to:m}))}else o(Z.updateActivity(a,b,c,d,h,e,f,g,i,j,k,l,m))}catch(q){p(q)}})}function bB(a){return new Promise((c,d)=>{try{if(empty(Z)){let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?c(JSON.parse(b.responseText)):d("Invalid JSON."))}),b.open("DELETE",$+"activity/delete.php",!0),b.send(JSON.stringify({username:af,token:ae,txID:a}))}else c(Z.deleteActivity(a))}catch(e){d(e)}})}function bC(c,e,f,g,h,i,j,k,l,m,n,o){let b=!0;for(let a=0;a<arguments.length;a++){let d=arguments[a];d.includes(",")&&(b=!1)}b?bE(c).then(a=>{empty(a.error)?bz(c,e.trim().toUpperCase(),f.trim(),g,h,i.trim(),j,k.trim(),l.trim().toUpperCase(),m,n.trim(),o.trim()).then(a=>{a9(),"message"in a?(a$(),_.success({title:"transaksi tersimpan",description:a.message})):_.error({title:"Error",description:a.error}),bg(),"disabled"!==ah.transactionsAffectHoldings&&a8()}).catch(a=>{_.error({title:"Error",description:"transaksi gagal disimpan."})}):_.error({title:"Error",description:"koin tidak ditemukan."})}).catch(a=>{console.log(a)}):_.error({title:"Error",description:"tidak dapat menggunakan koma."})}function bD(c){if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{if(a.readyState===XMLHttpRequest.DONE){if(validJSON(a.responseText)){let b=JSON.parse(a.responseText);"error"in b?_.error({title:"Error",description:b.error}):_.success({title:"transaksi di import",description:b.message})}else _.error({title:"Error",description:"Invalid JSON."})}}),a.open("POST",$+"activity/import.php",!0),a.send(JSON.stringify({username:af,token:ae,rows:c}))}else{let b=Z.importActivity(c);"error"in b?_.error({title:"Error",description:b.error}):_.success({title:"transaksi di import",description:b.message})}}function bE(a){return new Promise((e,c)=>{try{console.log("Fetching Coin...");let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("GET","https://api.coingecko.com/api/v3/coins/"+a,!0),b.send()}catch(d){c(d)}})}function bF(a,b){return new Promise((f,d)=>{try{if(empty(Z)){console.log("Fetching Coins... (API)");let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?f(JSON.parse(c.responseText)):d("Invalid JSON."))}),c.open("GET",$+"coins/read.php?token="+ae+"&username="+af+"&"+a+"="+b,!0),c.send()}else Z.readCoins({[a]:b}).then(a=>{f(a)}).catch(a=>{console.log(a),d(a)})}catch(e){d(e)}})}function bG(a){return new Promise((e,c)=>{try{console.log("Fetching Coin Info...");let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("GET","https://api.coingecko.com/api/v3/coins/"+a+"?localization=false&market_data=true",!0),b.send()}catch(d){c(d)}})}function bH(a,b,c,d){return new Promise((h,f)=>{try{if(empty(Z)){console.log("Fetching Historical Data... (API)");let e=new XMLHttpRequest;e.addEventListener("readystatechange",()=>{e.readyState===XMLHttpRequest.DONE&&(validJSON(e.responseText)?h(JSON.parse(e.responseText)):f("Invalid JSON."))}),e.open("GET",$+"historical/read.php?token="+ae+"&username="+af+"&ids="+a+"&currency="+b+"&from="+Math.floor(new Date(Date.parse(c)).getTime()/1e3)+"&to="+Math.floor(new Date(Date.parse(d)).getTime()/1e3),!0),e.send()}else Z.readHistorical(a,b,Math.floor(new Date(Date.parse(c)).getTime()/1e3),Math.floor(new Date(Date.parse(d)).getTime()/1e3),!1).then(a=>{h(a)}).catch(a=>{console.log(a),f(a)})}catch(g){f(g)}})}function bI(a){return new Promise((e,c)=>{try{console.log("Fetching Market Data...");let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("GET","https://api.coingecko.com/api/v3/coins/markets?vs_currency="+ah.currency+"&ids="+a+"&order=market_cap_desc&per_page=250&page=1&sparkline=false",!0),b.send()}catch(d){c(d)}})}function bJ(a,b){return new Promise((f,d)=>{try{console.log("Fetching Coin Price...");let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?f(JSON.parse(c.responseText)):d("Invalid JSON."))}),c.open("GET","https://api.coingecko.com/api/v3/coins/"+a+"/history?date="+b,!0),c.send()}catch(e){d(e)}})}function bK(b,c,d){let a=b.prices;a.push([c,d]);let e={labels:[],tooltips:[],prices:[]};return Object.keys(a).map(b=>{let c=a[b][0],d=parseFloat(a[b][1]);e.labels.push(new Date(c)),e.tooltips.push(formatDateHuman(new Date(c))),e.prices.push(d)}),e}function bL(a,b){return new Promise((f,d)=>{try{console.log("Fetching Market Data...");let c=new XMLHttpRequest;c.addEventListener("readystatechange",()=>{c.readyState===XMLHttpRequest.DONE&&(validJSON(c.responseText)?f(JSON.parse(c.responseText)):d("Invalid JSON."))}),c.open("GET","https://api.coingecko.com/api/v3/coins/markets?vs_currency="+ah.currency+"&order=market_cap_desc&per_page="+b+"&page="+a+"&sparkline=false",!0),c.send()}catch(e){d(e)}})}function bM(){return new Promise((d,b)=>{try{let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{a.readyState===XMLHttpRequest.DONE&&(validJSON(a.responseText)?d(JSON.parse(a.responseText)):b("Invalid JSON."))}),a.open("GET",$+"accounts/read-all.php?token="+ae+"&username="+af,!0),a.send()}catch(c){b(c)}})}function bN(a){return new Promise((e,c)=>{try{let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("POST",$+"accounts/create.php",!0),b.send(JSON.stringify({username:af,token:ae,account:a}))}catch(d){c(d)}})}function bO(a){return new Promise((e,c)=>{try{let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("DELETE",$+"accounts/delete.php",!0),b.send(JSON.stringify({username:af,token:ae,account:a}))}catch(d){c(d)}})}function bP(a){return new Promise((e,c)=>{try{console.log("Verifying Session...");let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("POST",$+"accounts/login.php",!0),b.send(JSON.stringify({username:af,token:a}))}catch(d){c(d)}})}function bQ(){return new Promise((b,c)=>{try{if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{a.readyState===XMLHttpRequest.DONE&&(validJSON(a.responseText)?b(JSON.parse(a.responseText)):c("Invalid JSON."))}),a.open("GET",$+"holdings/read.php?token="+ae+"&username="+af,!0),a.send()}else b(Z.readHoldings())}catch(d){c(d)}})}function bR(a){return new Promise((f,c)=>{try{console.log("Fetching Holdings Market Data...");let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{if(b.readyState===XMLHttpRequest.DONE){if(validJSON(b.responseText)){let d=JSON.parse(b.responseText);ai.totalValue=0;let e={};Object.keys(d).map(j=>{let b=d[j],f=b.id,g=b.current_price,h=a[f].amount,i=g*h,c=b.price_change_percentage_24h;c=empty(c)?"-":c.toFixed(2),e[f]={symbol:a[f].symbol,amount:h,value:i,price:g,change:c,image:b.image},ai.totalValue+=i}),f(Object.fromEntries(Object.entries(e).sort(([,a],[,b])=>b.value-a.value)))}else c("Invalid JSON.")}});let d=Object.keys(a).join("%2C");b.open("GET","https://api.coingecko.com/api/v3/coins/markets?vs_currency="+ah.currency+"&ids="+d+"&order=market_cap_desc&per_page=250&page=1&sparkline=false",!0),b.send()}catch(e){c(e)}})}function bS(){return new Promise((b,c)=>{try{if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{a.readyState===XMLHttpRequest.DONE&&(validJSON(a.responseText)?b(JSON.parse(a.responseText)):c("Invalid JSON."))}),a.open("GET",$+"activity/read.php?token="+ae+"&username="+af,!0),a.send()}else b(Z.readActivity())}catch(d){c(d)}})}function bT(b){let d={},a=[];for(let c in b)a.push([c,b[c].time]);return a.sort(function(a,b){return a[1]-b[1]}),a.map(a=>{d[a[0]]=b[a[0]]}),d}function bU(b){let d={},a=[];for(let c in b)a.push([c,b[c].time]);return a.sort(function(a,b){return a[1]-b[1]}),a.reverse().map(a=>{d[a[0]]=b[a[0]]}),d}function bV(a){let b=Object.keys(a),c={};return b.map(h=>{let d=a[h],b=d.id,i=d.symbol,f=d.type,g=parseFloat(d.amount);if(b in c||(c[b]={amount:0,symbol:i}),"sell"===f){let e=parseFloat(c[b].amount)-g;e<0&&(e=0),c[b].amount=e}else"buy"===f&&(c[b].amount=parseFloat(c[b].amount)+g)}),c}function bW(){return new Promise((b,c)=>{let a=document.createElement("input");a.type="file",a.click(),a.addEventListener("input",()=>{if(empty(a.files))a.remove(),c("file tidak di upload.");else{let e=a.files[0],d=new FileReader;d.readAsText(e,"UTF-8"),d.addEventListener("load",c=>{let d=c.target.result;a.remove(),b(d)}),d.addEventListener("error",b=>{a.remove(),_.error({title:"Error",description:"gagal."}),c(b)})}})})}function bX(a){return new Promise((e,c)=>{try{let b=new XMLHttpRequest;b.addEventListener("readystatechange",()=>{b.readyState===XMLHttpRequest.DONE&&(validJSON(b.responseText)?e(JSON.parse(b.responseText)):c("Invalid JSON."))}),b.open("GET","https://api.ethplorer.io/getAddressInfo/"+a+"?apiKey=freekey",!0),b.send()}catch(d){c(d)}})}function bY(){return new Promise((b,c)=>{try{if(empty(Z)){let a=new XMLHttpRequest;a.addEventListener("readystatechange",()=>{a.readyState===XMLHttpRequest.DONE&&(validJSON(a.responseText)?b(JSON.parse(a.responseText)):c("Invalid JSON."))}),a.open("DELETE",$+"historical/delete.php",!0),a.send(JSON.stringify({username:af,token:ae}))}else b(Z.deleteHistorical())}catch(d){c(d)}})}function bZ(b){let a=document.createElement("iframe");a.src=b,a.classList.add("hidden"),g.appendChild(a),a.addEventListener("load",()=>{a.remove()})}function b$(b,c){let d=encodeURI("data:text/csv;charset=utf-8,"+b),a=document.createElement("a");a.setAttribute("href",d),a.setAttribute("download",c),a.classList.add("hidden"),document.body.appendChild(a),a.click(),setTimeout(()=>{a.remove()},500)}function b_(){getLocalStorageSize().then(a=>{let b=100-100*a.remaining/a.size;aO.style.width=b+"%",aP.textContent=b.toFixed(0)+"%"}).catch(a=>{aP.textContent="Error",console.log(a)})}N.addEventListener("click",()=>{let b=aI.value,a=aJ.value,c=aK.value;empty(b)||empty(a)||empty(c)?_.error({title:"Error",description:"semua baris harus di isi."}):a===c?(aI.value="",aJ.value="",aK.value="",bn(b,a).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(_.success({title:"Password berubah",description:a.message}),aX())}).catch(a=>{console.log(a),_.error({title:"Error",description:"gagal merubah password."})})):_.error({title:"Error",description:"password tidak sama."})}),O.addEventListener("click",()=>{bM().then(g=>{let a=g.accounts,h=240,e=40*a.length;a.length>=3&&(e=120);let c=h+e+20;b.style.height=c+"px",b.style.top="calc(50% - "+c+"px / 2)",aZ("Atur Akun",'<div id="popup-list" class="popup-list"></div><div id="popup-choice"><button id="popup-create" data-value="create" class="choice active">Buat</button><button id="popup-delete" data-value="delete" class="choice">Hapus</button></div><input id="popup-username" placeholder="Username..." type="text"><button class="reject" id="popup-cancel">Batal</button><button class="resolve" id="popup-confirm">Konfirmasi</button>',"300px",c+"px");let i=document.getElementById("popup-list"),j=document.getElementById("popup-username");a.map(b=>{let a=document.createElement("div");a.innerHTML='<span class="title">'+b+"</span>",a.addEventListener("click",()=>{j.value=b}),i.appendChild(a)});let f=document.getElementById("popup-choice").getElementsByClassName("choice");for(let d=0;d<f.length;d++)f[d].addEventListener("click",()=>{for(let a=0;a<f.length;a++)f[a].classList.remove("active");f[d].classList.add("active")});document.getElementById("popup-cancel").addEventListener("click",()=>{a$()}),document.getElementById("popup-confirm").addEventListener("click",()=>{let a=j.value;empty(a)?_.error({title:"Error",description:"semua baris harus di isi."}):"admin"!==a.toLowerCase().trim()?document.getElementById("popup-create").classList.contains("active")?bN(a).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(_.success({title:"Akun berhasil dibuat",description:a.message}),a$())}).catch(a=>{console.log(a),_.alert({title:"Anda yakin?",description:"Klik lagi untuk konfirmasi."})}):bO(a).then(a=>{"error"in a?_.error({title:"Error",description:a.error}):(_.success({title:"Akun berhasil dihapus",description:a.message}),a$())}).catch(a=>{console.log(a),_.error({title:"Error",description:"gagal hapus akun."})}):_.error({title:"Error",description:"akun admin tidak dapat dirubah."})})}).catch(a=>{console.log(a),_.error({title:"Error",description:"gagal."})})}),Q.addEventListener("click",()=>{aM.select(),aM.setSelectionRange(0,99999),document.execCommand("copy"),window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),_.success({title:"Berhasil",description:"URL berhasil disimpan."})}),R.addEventListener("click",()=>{let a=aN.value;empty(a)?_.error({title:"Error",description:"gagal."}):bX(a).then(a=>{parseFloat(a.ETH.balance.toFixed(3));let b=a.tokens,c=0;Object.keys(b).map(h=>{c++;let e=b[h],a=e.tokenInfo,d=a.symbol;if("coingecko"in a){let f=e.balance.toFixed(0),i=parseInt(a.decimals),j=f.length-i,g=f.split("");g.splice(j,0,".");let k=g.join(""),l=a.coingecko,m=parseFloat(parseFloat(k).toFixed(2));setTimeout(()=>{bF("id",l).then(a=>{"id"in a?"add"===ah.importTokens?bq(l,m):bs(l,m):_.error({title:"Error",description:"tidak dapat menambahkan "+d+"."})}).catch(a=>{console.log(a),_.error({title:"Error",description:"tidak dapat menemukan "+d+"."})})},4e3*c),_.info({title:"Menambahkan "+d,description:"Menambahkan koin di dalam portofolio."})}else _.error({title:d+" Not Found",description:d+" koin tidak terdaftar di coinmarket API."})})}).catch(a=>{console.log(a),_.error({title:"Error",description:"gagal."})})}),S.addEventListener("click",()=>{bW().then(b=>{let a=b.split(/\r?\n/);if("id,symbol,amount"===a[0]){let c=[];a.map(a=>{empty(a)||a.toLowerCase().includes("symbol,")||c.push(a)}),bu(c)}else _.error({title:"Error",description:"gagal. contoh: id, symbol, amount.",duration:8e3})})}),T.addEventListener("click",()=>{empty(Z)?bZ($+"holdings/export.php?token="+ae+"&username="+af):b$(Z.exportHoldings(),"Holdings-"+Math.floor(new Date().getTime()/1e3)+".csv")}),U.addEventListener("click",()=>{bW().then(b=>{let a=b.split(/\r?\n/);if(a[0].includes("id,symbol,date,type,amount,fee,notes,exchange,pair,price,from,to")){let c=[];a.map(b=>{empty(b)||b.toLowerCase().includes("symbol,")||(a[0].includes("txID")?c.push(b):c.push("-,"+b))}),bD(c)}else _.error({title:"Error",description:"gagal. contoh: id, symbol, date, type, amount, fee, notes, exchange, pair, price, from, to.",duration:12e3})})}),V.addEventListener("click",()=>{empty(Z)?bZ($+"activity/export.php?token="+ae+"&username="+af):b$(Z.exportActivity(),"Activity-"+Math.floor(new Date().getTime()/1e3)+".csv")}),W.addEventListener("click",()=>{bY().then(a=>{"error"in a?_.error({title:"Error",description:a.error}):_.success({title:"Cache dihapus",description:a.message})}).catch(a=>{console.log(a),_.error({title:"Error",description:"Couldn't delete cache."})})})}),String.prototype.replaceAll=function(b,a,c){return this.replace(new RegExp(b.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),c?"gi":"g"),"string"==typeof a?a.replace(/\$/g,"$$$$"):a)}